<?xml version="1.0"?>
<odoo>
    <data>
        <record model="ir.actions.act_window" id="employee_loan_salary_list_action">
            <field name="name">Employee loan salary advance</field>
            <field name="res_model">hr.loan.salary.advance</field>
            <field name="view_mode">tree,form</field>
            <field name= "context">{"search_default_my_request":1}</field>		
        </record>
        <record model="ir.ui.view" id="employee_loan_salary_form_view">
            <field name="name">Employee loan salary advance</field>
            <field name="model">hr.loan.salary.advance</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button name="submit" string="Submit" class="oe_highlight" type="object"
                                states="draft" groups="base.group_user"/>

                        <button name="direct_manager" string="Payroll Officer Approve" class="oe_highlight" type="object"
                                states="submit" groups="hr_loans_salary_advance.group_loan_manager"/>
                        <button name="refused" string="Refuse"  states="submit" type="object"
                                groups="hr_loans_salary_advance.group_loan_manager" class="oe_highlight"/>

                        <button name="hr_manager" string="HR Manager Approve" class="oe_highlight" type="object"
                                states="direct_manager" groups="hr.group_hr_manager"/>
                        <button name="refused" string="Refuse"  states="direct_manager" type="object"
                                groups="hr.group_hr_manager" class="oe_highlight"/>

                        <button name="executive_manager" string="GM Manager Approve" class="oe_highlight" type="object"
                                states="hr_manager" groups="hr_base.group_general_manager"/>
                        <button name="refused" string="Refuse"  states="hr_manager" type="object"
                                groups="hr_base.group_general_manager" class="oe_highlight"/>

                        <button name="pay" string="Transfer" class="oe_highlight" type="object"
                                states="executive_manager" groups="hr_base.group_account_manager"/>
                        <button name="refused" string="Refuse"  states="executive_manager" type="object"
                                groups="hr_base.group_account_manager" class="oe_highlight"/>

                        <button name="closed" string="Loan Suspension" class="oe_highlight" type="object"
                                states="pay" groups="hr.group_hr_manager" confirm="Are you Sure To Loan Suspension?"/>
                        <button name="refused" string="Refuse" class="oe_highlight" type="object"
                                states="pay" groups="hr.group_hr_manager"/>

                        <button name="draft_state" string="RE-Draft" class="oe_highlight" type="object" states="refused"
                                groups="hr.group_hr_manager,hr_loans_salary_advance.group_loan_manager"
                                confirm="Are you sure to Reset To Draft This Record?"/>
                        <button name="to_re_paid" string="Return To Deduct" class="oe_highlight" type="object" states="closed"
                                groups="hr.group_hr_manager,hr_loans_salary_advance.group_loan_manager" confirm="Are you Sure To Re Deduction?"/>
                        <field name="state" widget="statusbar"
                               statusbar_visible="draft,submit,direct_manager,hr_manager,executive_manager,pay,closed,refused"/>
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field name="code" string="Code" readonly="1"/>
                                <field name="from_hr_depart" string="Another Employee"
                                       attrs="{'readonly':[('state','!=','draft')]}"/>
                                <field name="employee_id" string="Employee Name"
                                       attrs="{'readonly':['|',('state','!=','draft'),('from_hr_depart','=',False)],'required':True}"/>
                                <field name="employee_no" string="Employee Number" readonly="1"/>
                                <field name="request_type" string="Request Type" required="True"
                                       attrs="{'readonly':[('state','!=','draft')]}"/>
                                <field name="date" string="Date Request" required="True"
                                       attrs="{'readonly':[('state','!=','draft')]}"/>
                                <field name="department_id" string="Department" readonly="1"
                                       attrs="{'readonly':[('state','!=','draft')]}"/>
                                <field name="job_id" string="Job Position" readonly="1"
                                       attrs="{'readonly':[('state','!=','draft')]}"/>
                            </group>
                            <group>
                                <field name="is_old" string="Is Old" attrs="{'readonly':[('state','!=','draft')]}"/>
<!--                                <field name="evaluation_grade" string="Evaluation Grad"/>-->
                                <field name="company_id" string="Company" readonly="1"/>
                                <field name="contract_duration_date" string="contract Start Date" readonly="1"/>
                                <field name="emp_hiring_date" string="Hiring Date" readonly="1"/>
                                <field name="end_date" string="Contract End Date" readonly="1"/>
                                <field name="months_employeed" string="working duration(months)" readonly="1"/>
                            </group>
                            <group>
                                <field name="exception_loan" string="Exception Loan" groups="hr.group_hr_manager" 
                                       attrs="{'readonly':[('state','!=','draft')]}"/>
                                <field name="basic_amount" string="Basic Amount" readonly="1" force_save="1"/>
                                <field name="emp_expect_amount" string="Request Employee Amount" required="True"
                                       attrs="{'readonly':[('state','!=','draft')]}"/>
<!--                                <field name="finance_propos_amount" string="Finance proposed Amount"-->
<!--                                       attrs="{'readonly':[('state','!=','draft')]}"/>-->
                                <field name="gm_propos_amount" string="Approved Amount"
                                       attrs="{'readonly':[('state','!=','draft')]}"/>
                                <field name="months" string="Number of months"
                                       attrs="{'readonly':[('state','!=','draft')]}"/>
                                <button name="create_loan" string="Create Loan" type="object" class="oe_highlight"
                                        attrs="{'invisible':[('state','!=','draft')]}"/>
                            </group>
                            <group name="loans_salary">
                                <field name="monthly_salary" string="Salary of Month" readonly="1"/>
                                <field name="total_paid_inst" string="total paid installment" readonly="1"/>
                                <field name="remaining_loan_amount" string="Remaining loan Amount" readonly="1"/>
                                <field name="installment_amount" string="installment Amount" readonly="1"/>
                                <!--field name="previous_loan" string="previous" readonly="1"/-->
                            </group>
                        </group>
                        <notebook>
                            <page string="Deduction Over Months" name="deduction_over _months">
                                <group string=" Deduction Over Months">
                                    <field name="date" string="Start Date"
                                           attrs="{'readonly':[('state','!=','draft')]}"/>
                                </group>
                                <field name="deduction_lines" string="lines"
                                       attrs="{'readonly':[('state','!=','draft')]}">
                                    <tree editable="bottom" default_order="installment_date asc,sequence asc">
                                        <field name="sequence" string="Sequence" readonly="1"/>
                                        <field name="installment_date" string="installment Date" readonly="1"/>
                                        <button name="postpone_of_installment" string="Postpone of installment" type="object"
                                                groups="hr.group_hr_manager"
                                                attrs="{'invisible':['|',('paid','=',True),('parent.state','=','draft')]}"/>
                                        <field name="installment_amount" string="installment Amount" readonly="1"/>
                                        <field name="paid" string="Paid" readonly="1"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Accounting Info" name="accounting_info">
                                <group>
                                    <field name="payment_ref" string="Payment Order Ref"
                                           attrs="{'readonly':[('state','!=','draft')]}"/>
                                </group>
                                <field name="moves_ids" string="Journal Entries"
                                       attrs="{'readonly':[('state','!=','draft')]}">
                                    <tree editable="bottom">
                                        <field name="number" string="Number"/>
                                        <field name="reference" string="Reference"/>
                                        <field name="period" string="period"/>
                                        <field name="journal" string="Journal"/>
                                        <field name="partner_id" string="Partner"/>
                                        <field name="amount" string="Amount"/>
                                        <field name="status" string="Status"/>
                                        <field name="journal_move_id" string="Account move"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="employee_loan_salary_tree_view">
            <field name="name">Employee loan salary advance</field>
            <field name="model">hr.loan.salary.advance</field>
            <field name="arch" type="xml">
                <tree decoration-success="state=='closed'" decoration-danger="state == 'refused'"
                      decoration-info="state == 'draft'" string="Employee official mission">
                    <field name="employee_no" string="Employee Number"/>
                    <field name="employee_id" string="Employee Id"/>
                    <field name="department_id" string="Department" />
                    <field name="code" string="Code" optional="hide"/>
                    <field name="request_type" string="Request Type"/>
                    <field name="date" string="Date"/>
                    <field name="gm_propos_amount" string="Loan Amount"/>
                    <field name="remaining_loan_amount" string="Remaining Amount"/>
                    <field name="installment_amount" string="Installment Amount"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <!--penalty_register_filter -->
        <record id="hr_loan_salary_advance_filter" model="ir.ui.view">
            <field name="name">Employee loan salary advance</field>
            <field name="model">hr.loan.salary.advance</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search>
                  <field name="employee_id"/>
                  <field name="employee_no"/>
                  <field name="department_id" />
                    <group expand="0" string="Group By">
                        <filter name="group_employee" string="Employee" domain="[]" context="{'group_by': 'employee_id'}"/>
                        <filter name="group_loan" string="Loan Type" domain="[]" context="{'group_by': 'request_type'}"/>
                        <filter name="group_department" string="Department" domain="[]" context="{'group_by': 'department_id'}"/>
                    </group>
                    <separator/>
                        <filter string="My Requests" name="my_request" domain="[('employee_id.user_id', '=', uid)]"/>
                    <separator/>
                </search>
            </field>
        </record>

        <!-- Loans menu -->
        <menuitem id="loans_menu_id" name="Employee Loans" parent="hr.menu_hr_root" sequence="3"/>
        <menuitem name="Loans/Salary Advance"

                  id="employee_loan_salary_menu_item"
                  parent="loans_menu_id"
                  groups="hr_loans_salary_advance.group_loan_manager,hr_loans_salary_advance.group_loan_user"

                  action="employee_loan_salary_list_action" sequence="1"/>

    </data>
</odoo>
